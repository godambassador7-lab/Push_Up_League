rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection - Allow read for all, write only for authenticated users updating their own data
    match /users/{userId} {
      // Allow anyone to read user profiles (for leaderboards)
      allow read: if true;

      // Allow authenticated users to create/update their own profile
      allow create, update: if request.auth != null && request.auth.uid == userId;

      // Prevent deletion
      allow delete: if false;
    }

    // Workouts collection - Allow read for all, write only for authenticated users
    match /workouts/{workoutId} {
      // Allow anyone to read workouts (for leaderboards and statistics)
      allow read: if true;

      // Allow authenticated users to create workouts
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

      // Allow users to update their own workouts
      allow update: if request.auth != null && resource.data.userId == request.auth.uid;

      // Prevent deletion (workouts should be locked, not deleted)
      allow delete: if false;
    }

    // Achievements collection - Allow read for all, write only for authenticated users
    match /achievements/{achievementId} {
      // Allow anyone to read achievements
      allow read: if true;

      // Allow authenticated users to create their own achievements
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

      // Prevent updates and deletions (achievements are permanent)
      allow update, delete: if false;
    }

    // Default deny all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
