"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[251],{8251:function(e,t,a){a.r(t),a.d(t,{SyncManager:function(){return n},syncManager:function(){return c},useManualSync:function(){return u},useSyncManager:function(){return l}});var r=a(2249),s=a(2265),o=a(3754),i=a(6410);class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}initialize(){(0,i.w7)(e=>{e?this.handleUserLogin(e):this.handleUserLogout()}),this.syncInterval=setInterval(()=>{this.performPeriodicSync()},3e4),this.loadFromLocalStorage()}async handleUserLogin(e){let t=o.CT.getState();try{console.log("\uD83D\uDD04 Loading user data from Firebase for:",e.uid);let a=await (0,i.et)(e.uid);a?(console.log("✅ Profile loaded from Firebase:",a),t.setUserProfile(a.email,a.proficiency,a.maxPushupsInOneSet),o.CT.setState({userId:a.userId,username:a.username,email:a.email,isAuthenticated:!0,proficiency:a.proficiency,maxPushupsInOneSet:a.maxPushupsInOneSet,isWorldRecordCandidate:a.isWorldRecordCandidate,waiverAccepted:a.waiverAccepted||!1,waiverAcceptedAt:a.waiverAcceptedAt||null,waiverVersion:a.waiverVersion||null,waiverSignatureName:a.waiverSignatureName||null,accountCreatedAt:a.accountCreatedAt||null,totalXp:a.totalXp,coins:a.coins,currentRank:a.currentRank,currentStreak:a.currentStreak,longestStreak:a.longestStreak,lastWorkoutDate:a.lastWorkoutDate,personalBest:a.personalBest,dailyGoal:a.dailyGoal,streakFreezes:a.streakFreezes,bodyWeightKg:a.bodyWeightKg||77,totalLifetimePushups:a.totalLifetimePushups||0,variationStats:a.variationStats||o.CT.getState().variationStats,variationPBs:a.variationPBs||o.CT.getState().variationPBs,purchasedTitles:a.purchasedTitles||[],activeTitle:a.activeTitle||null,unlockedAchievements:a.unlockedAchievements||[]})):console.warn("⚠️ No profile found in Firebase for user:",e.uid);let r=await (0,i.SB)(e.uid);console.log("\uD83D\uDCCA Loaded ".concat(r.length," workouts from Firebase")),r.length>0?o.CT.setState({workouts:r.map(e=>({id:e.id,date:e.date,pushups:e.pushups,sets:e.sets,xpEarned:e.xpEarned,coinsEarned:e.coinsEarned||0,goalCompleted:e.goalCompleted||!1,streakMultiplier:e.streakMultiplier,challengeBonus:e.challengeBonus,isLocked:e.isLocked,lockedAt:e.lockedAt}))}):console.warn("⚠️ No workouts found in Firebase for user:",e.uid);try{let t=await (0,i.Mp)(e.uid);t.length>0&&o.CT.setState({achievements:t.map(e=>({id:e.id,title:e.title,description:e.description,unlockedAt:e.unlockedAt,type:e.type}))})}catch(e){console.warn("Could not load achievements from Firebase:",e)}this.unsubscribeWorkouts=(0,i.vA)(e.uid,e=>{console.log("\uD83D\uDD14 Real-time update: ".concat(e.length," workouts")),o.CT.setState({workouts:e.map(e=>({id:e.id,date:e.date,pushups:e.pushups,sets:e.sets,xpEarned:e.xpEarned,coinsEarned:e.coinsEarned||0,goalCompleted:e.goalCompleted||!1,streakMultiplier:e.streakMultiplier,challengeBonus:e.challengeBonus,isLocked:e.isLocked,lockedAt:e.lockedAt}))}),this.saveToLocalStorage()}),this.saveToLocalStorage(),console.log("\uD83D\uDCBE Data saved to localStorage")}catch(e){console.error("❌ Error loading user data from Firebase:",e)}}handleUserLogout(){this.unsubscribeWorkouts&&(this.unsubscribeWorkouts(),this.unsubscribeWorkouts=null),this.saveToLocalStorage()}async syncToFirebase(){let e=o.CT.getState();if(!e.isAuthenticated||!e.userId){console.log("⏭️ Skipping sync - not authenticated");return}console.log("\uD83D\uDD04 Syncing to Firebase...");try{console.log("\uD83D\uDCE4 Uploading user profile to Firebase..."),await (0,i.Lj)(e.userId,{userId:e.userId,username:e.username,email:e.email,proficiency:e.proficiency,maxPushupsInOneSet:e.maxPushupsInOneSet,isWorldRecordCandidate:e.isWorldRecordCandidate,waiverAccepted:e.waiverAccepted,waiverAcceptedAt:e.waiverAcceptedAt,waiverVersion:e.waiverVersion,waiverSignatureName:e.waiverSignatureName,accountCreatedAt:e.accountCreatedAt,totalXp:e.totalXp,coins:e.coins,currentRank:e.currentRank,currentStreak:e.currentStreak,longestStreak:e.longestStreak,lastWorkoutDate:e.lastWorkoutDate,personalBest:e.personalBest,dailyGoal:e.dailyGoal,streakFreezes:e.streakFreezes,bodyWeightKg:e.bodyWeightKg,totalLifetimePushups:e.totalLifetimePushups,variationStats:e.variationStats,variationPBs:e.variationPBs,purchasedTitles:e.purchasedTitles,activeTitle:e.activeTitle,unlockedAchievements:e.unlockedAchievements}),console.log("✅ User profile synced to Firebase");let t=await (0,i.SB)(e.userId),a=new Set(t.map(e=>e.id)),r=0;for(let t of e.workouts)!a.has(t.id)&&(await (0,i.Mg)({...t,sets:t.sets,userId:e.userId,createdAt:null}),r++);r>0&&console.log("✅ Synced ".concat(r," new workout(s) to Firebase"));try{let t=await (0,i.Mp)(e.userId),a=new Set(t.map(e=>e.id));for(let t of e.achievements)a.has(t.id)||await (0,i.Sz)({...t,userId:e.userId})}catch(e){console.warn("Could not sync achievements to Firebase:",e)}this.lastSyncTimestamp=Date.now(),console.log("✅ Firebase sync complete")}catch(e){console.error("❌ Error syncing to Firebase:",e)}}async performPeriodicSync(){o.CT.getState().isAuthenticated&&await this.syncToFirebase(),this.saveToLocalStorage()}saveToLocalStorage(){let e=o.CT.getState(),t={userId:e.userId,username:e.username,email:e.email,proficiency:e.proficiency,maxPushupsInOneSet:e.maxPushupsInOneSet,isWorldRecordCandidate:e.isWorldRecordCandidate,waiverAccepted:e.waiverAccepted,waiverAcceptedAt:e.waiverAcceptedAt,waiverVersion:e.waiverVersion,waiverSignatureName:e.waiverSignatureName,accountCreatedAt:e.accountCreatedAt,totalXp:e.totalXp,coins:e.coins,currentRank:e.currentRank,currentStreak:e.currentStreak,longestStreak:e.longestStreak,lastWorkoutDate:e.lastWorkoutDate,workouts:e.workouts,achievements:e.achievements,personalBest:e.personalBest,dailyGoal:e.dailyGoal,streakFreezes:e.streakFreezes,powerUpPurchaseHistory:e.powerUpPurchaseHistory,bodyWeightKg:e.bodyWeightKg,totalLifetimePushups:e.totalLifetimePushups,variationStats:e.variationStats,variationPBs:e.variationPBs,purchasedTitles:e.purchasedTitles,activeTitle:e.activeTitle,unlockedAchievements:e.unlockedAchievements,lastSyncTimestamp:this.lastSyncTimestamp};try{localStorage.setItem("pushup-league-data",JSON.stringify(t))}catch(e){console.error("Error saving to localStorage:",e)}}loadFromLocalStorage(){try{let e=localStorage.getItem("pushup-league-data");if(e){let t=JSON.parse(e);o.CT.setState({userId:t.userId,username:t.username,email:t.email,proficiency:t.proficiency||"beginner",maxPushupsInOneSet:t.maxPushupsInOneSet||10,isWorldRecordCandidate:t.isWorldRecordCandidate||!1,waiverAccepted:t.waiverAccepted||!1,waiverAcceptedAt:t.waiverAcceptedAt||null,waiverVersion:t.waiverVersion||null,waiverSignatureName:t.waiverSignatureName||null,accountCreatedAt:t.accountCreatedAt||null,totalXp:t.totalXp||0,coins:t.coins||0,currentRank:t.currentRank||1,currentStreak:t.currentStreak||0,longestStreak:t.longestStreak||0,lastWorkoutDate:t.lastWorkoutDate||null,workouts:t.workouts||[],achievements:t.achievements||[],personalBest:t.personalBest||0,dailyGoal:t.dailyGoal||50,streakFreezes:t.streakFreezes||1,powerUpPurchaseHistory:t.powerUpPurchaseHistory||o.CT.getState().powerUpPurchaseHistory,bodyWeightKg:t.bodyWeightKg||77,totalLifetimePushups:t.totalLifetimePushups||0,variationStats:t.variationStats||o.CT.getState().variationStats,variationPBs:t.variationPBs||o.CT.getState().variationPBs,purchasedTitles:t.purchasedTitles||[],activeTitle:t.activeTitle||null,unlockedAchievements:t.unlockedAchievements||[]}),this.lastSyncTimestamp=t.lastSyncTimestamp||0}}catch(e){console.error("Error loading from localStorage:",e)}}async forceSyncNow(){await this.syncToFirebase(),this.saveToLocalStorage()}cleanup(){this.unsubscribeWorkouts&&this.unsubscribeWorkouts(),this.syncInterval&&clearInterval(this.syncInterval)}constructor(){(0,r._)(this,"unsubscribeWorkouts",null),(0,r._)(this,"syncInterval",null),(0,r._)(this,"lastSyncTimestamp",0)}}(0,r._)(n,"instance",void 0);let c=n.getInstance();function l(){(0,s.useEffect)(()=>(c.initialize(),()=>{c.cleanup()}),[])}function u(){return{syncNow:()=>c.forceSyncNow(),saveLocal:()=>c.saveToLocalStorage()}}},2249:function(e,t,a){a.d(t,{_:function(){return r}});function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}}}]);