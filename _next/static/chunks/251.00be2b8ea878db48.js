"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[251],{8251:function(e,t,a){a.r(t),a.d(t,{SyncManager:function(){return o},syncManager:function(){return c},useManualSync:function(){return u},useSyncManager:function(){return l}});var r=a(2249),s=a(2265),i=a(3754),n=a(6410);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}initialize(){(0,n.w7)(e=>{e?this.handleUserLogin(e):this.handleUserLogout()}),this.syncInterval=setInterval(()=>{this.performPeriodicSync()},3e4),this.loadFromLocalStorage()}async handleUserLogin(e){let t=i.CT.getState();try{let a=await (0,n.et)(e.uid);a&&(t.setUserProfile(a.email,a.proficiency,a.maxPushupsInOneSet),i.CT.setState({userId:a.userId,username:a.username,email:a.email,isAuthenticated:!0,proficiency:a.proficiency,maxPushupsInOneSet:a.maxPushupsInOneSet,isWorldRecordCandidate:a.isWorldRecordCandidate,waiverAccepted:a.waiverAccepted||!1,waiverAcceptedAt:a.waiverAcceptedAt||null,waiverVersion:a.waiverVersion||null,waiverSignatureName:a.waiverSignatureName||null,accountCreatedAt:a.accountCreatedAt||null,totalXp:a.totalXp,coins:a.coins,currentRank:a.currentRank,currentStreak:a.currentStreak,longestStreak:a.longestStreak,lastWorkoutDate:a.lastWorkoutDate,personalBest:a.personalBest,dailyGoal:a.dailyGoal,streakFreezes:a.streakFreezes,bodyWeightKg:a.bodyWeightKg||77,totalLifetimePushups:a.totalLifetimePushups||0,variationStats:a.variationStats||i.CT.getState().variationStats,variationPBs:a.variationPBs||i.CT.getState().variationPBs,purchasedTitles:a.purchasedTitles||[],activeTitle:a.activeTitle||null,unlockedAchievements:a.unlockedAchievements||[]}));let r=await (0,n.SB)(e.uid);r.length>0&&i.CT.setState({workouts:r.map(e=>({id:e.id,date:e.date,pushups:e.pushups,sets:e.sets,xpEarned:e.xpEarned,coinsEarned:e.coinsEarned||0,goalCompleted:e.goalCompleted||!1,streakMultiplier:e.streakMultiplier,challengeBonus:e.challengeBonus,isLocked:e.isLocked,lockedAt:e.lockedAt}))});try{let t=await (0,n.Mp)(e.uid);t.length>0&&i.CT.setState({achievements:t.map(e=>({id:e.id,title:e.title,description:e.description,unlockedAt:e.unlockedAt,type:e.type}))})}catch(e){console.warn("Could not load achievements from Firebase:",e)}this.unsubscribeWorkouts=(0,n.vA)(e.uid,e=>{i.CT.setState({workouts:e.map(e=>({id:e.id,date:e.date,pushups:e.pushups,sets:e.sets,xpEarned:e.xpEarned,coinsEarned:e.coinsEarned||0,goalCompleted:e.goalCompleted||!1,streakMultiplier:e.streakMultiplier,challengeBonus:e.challengeBonus,isLocked:e.isLocked,lockedAt:e.lockedAt}))})}),this.saveToLocalStorage()}catch(e){console.error("Error loading user data from Firebase:",e)}}handleUserLogout(){this.unsubscribeWorkouts&&(this.unsubscribeWorkouts(),this.unsubscribeWorkouts=null),this.saveToLocalStorage()}async syncToFirebase(){let e=i.CT.getState();if(e.isAuthenticated&&e.userId)try{await (0,n.Lj)(e.userId,{userId:e.userId,username:e.username,email:e.email,proficiency:e.proficiency,maxPushupsInOneSet:e.maxPushupsInOneSet,isWorldRecordCandidate:e.isWorldRecordCandidate,waiverAccepted:e.waiverAccepted,waiverAcceptedAt:e.waiverAcceptedAt,waiverVersion:e.waiverVersion,waiverSignatureName:e.waiverSignatureName,accountCreatedAt:e.accountCreatedAt,totalXp:e.totalXp,coins:e.coins,currentRank:e.currentRank,currentStreak:e.currentStreak,longestStreak:e.longestStreak,lastWorkoutDate:e.lastWorkoutDate,personalBest:e.personalBest,dailyGoal:e.dailyGoal,streakFreezes:e.streakFreezes,bodyWeightKg:e.bodyWeightKg,totalLifetimePushups:e.totalLifetimePushups,variationStats:e.variationStats,variationPBs:e.variationPBs,purchasedTitles:e.purchasedTitles,activeTitle:e.activeTitle,unlockedAchievements:e.unlockedAchievements});let t=await (0,n.SB)(e.userId),a=new Set(t.map(e=>e.id));for(let t of e.workouts)a.has(t.id)||await (0,n.Mg)({...t,sets:t.sets,userId:e.userId,createdAt:null});try{let t=await (0,n.Mp)(e.userId),a=new Set(t.map(e=>e.id));for(let t of e.achievements)a.has(t.id)||await (0,n.Sz)({...t,userId:e.userId})}catch(e){console.warn("Could not sync achievements to Firebase:",e)}this.lastSyncTimestamp=Date.now()}catch(e){console.error("Error syncing to Firebase:",e)}}async performPeriodicSync(){i.CT.getState().isAuthenticated&&await this.syncToFirebase(),this.saveToLocalStorage()}saveToLocalStorage(){let e=i.CT.getState(),t={userId:e.userId,username:e.username,email:e.email,proficiency:e.proficiency,maxPushupsInOneSet:e.maxPushupsInOneSet,isWorldRecordCandidate:e.isWorldRecordCandidate,waiverAccepted:e.waiverAccepted,waiverAcceptedAt:e.waiverAcceptedAt,waiverVersion:e.waiverVersion,waiverSignatureName:e.waiverSignatureName,accountCreatedAt:e.accountCreatedAt,totalXp:e.totalXp,coins:e.coins,currentRank:e.currentRank,currentStreak:e.currentStreak,longestStreak:e.longestStreak,lastWorkoutDate:e.lastWorkoutDate,workouts:e.workouts,achievements:e.achievements,personalBest:e.personalBest,dailyGoal:e.dailyGoal,streakFreezes:e.streakFreezes,powerUpPurchaseHistory:e.powerUpPurchaseHistory,bodyWeightKg:e.bodyWeightKg,totalLifetimePushups:e.totalLifetimePushups,variationStats:e.variationStats,variationPBs:e.variationPBs,purchasedTitles:e.purchasedTitles,activeTitle:e.activeTitle,unlockedAchievements:e.unlockedAchievements,lastSyncTimestamp:this.lastSyncTimestamp};try{localStorage.setItem("pushup-league-data",JSON.stringify(t))}catch(e){console.error("Error saving to localStorage:",e)}}loadFromLocalStorage(){try{let e=localStorage.getItem("pushup-league-data");if(e){let t=JSON.parse(e);i.CT.setState({userId:t.userId,username:t.username,email:t.email,proficiency:t.proficiency||"beginner",maxPushupsInOneSet:t.maxPushupsInOneSet||10,isWorldRecordCandidate:t.isWorldRecordCandidate||!1,waiverAccepted:t.waiverAccepted||!1,waiverAcceptedAt:t.waiverAcceptedAt||null,waiverVersion:t.waiverVersion||null,waiverSignatureName:t.waiverSignatureName||null,accountCreatedAt:t.accountCreatedAt||null,totalXp:t.totalXp||0,coins:t.coins||0,currentRank:t.currentRank||1,currentStreak:t.currentStreak||0,longestStreak:t.longestStreak||0,lastWorkoutDate:t.lastWorkoutDate||null,workouts:t.workouts||[],achievements:t.achievements||[],personalBest:t.personalBest||0,dailyGoal:t.dailyGoal||50,streakFreezes:t.streakFreezes||1,powerUpPurchaseHistory:t.powerUpPurchaseHistory||i.CT.getState().powerUpPurchaseHistory,bodyWeightKg:t.bodyWeightKg||77,totalLifetimePushups:t.totalLifetimePushups||0,variationStats:t.variationStats||i.CT.getState().variationStats,variationPBs:t.variationPBs||i.CT.getState().variationPBs,purchasedTitles:t.purchasedTitles||[],activeTitle:t.activeTitle||null,unlockedAchievements:t.unlockedAchievements||[]}),this.lastSyncTimestamp=t.lastSyncTimestamp||0}}catch(e){console.error("Error loading from localStorage:",e)}}async forceSyncNow(){await this.syncToFirebase(),this.saveToLocalStorage()}cleanup(){this.unsubscribeWorkouts&&this.unsubscribeWorkouts(),this.syncInterval&&clearInterval(this.syncInterval)}constructor(){(0,r._)(this,"unsubscribeWorkouts",null),(0,r._)(this,"syncInterval",null),(0,r._)(this,"lastSyncTimestamp",0)}}(0,r._)(o,"instance",void 0);let c=o.getInstance();function l(){(0,s.useEffect)(()=>(c.initialize(),()=>{c.cleanup()}),[])}function u(){return{syncNow:()=>c.forceSyncNow(),saveLocal:()=>c.saveToLocalStorage()}}},2249:function(e,t,a){a.d(t,{_:function(){return r}});function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}}}]);